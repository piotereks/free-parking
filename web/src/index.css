@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base layer - global resets and defaults */
@layer base {
  html,
  body {
    @apply m-0 p-0 w-full h-full overflow-auto;
  }

  body {
    @apply font-sans transition-theme duration-300;
  }

  /* CSS Custom Properties */
  :root {
    --accent-glow: #00d9ff;
  }

  /* Light theme (default) */
  body {
    @apply bg-bg-primary-light text-text-primary-light;
  }

  /* Dark theme */
  body.dark {
    @apply bg-bg-primary-dark text-text-primary-dark;
  }
}

/* Component layer - reusable component classes */
@layer components {
  /* Layout */
  .page-wrapper {
    @apply flex flex-col h-screen w-screen;
  }

  .container-main {
    @apply max-w-screen-xl mx-auto px-8 py-8 flex-1 overflow-y-auto;
    /* Ensure main content sits below the fixed header and can scroll */
    padding-top: 76px;
    @apply flex flex-col items-center;
  }

  /* Wrapper for centering dashboard content */
  .container-main > * {
    @apply w-full max-w-5xl;
  }

  /* Header */
  .header-controls {
    @apply flex justify-between items-center px-6 z-[100] flex-shrink-0;
    @apply bg-bg-secondary-light border-b border-border-light transition-theme duration-300;
    height: 60px;
    box-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
    padding-right: 220px; /* reserve space for header actions so they don't wrap */
  }

  /* Fix header to top so dashboard content scrolls underneath */
  .header-controls {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
  }

  .dark .header-controls {
    @apply bg-bg-secondary-dark border-border-dark;
  }

  .header-title-group {
    @apply flex flex-col;
    flex: 1 1 auto; /* allow title to take remaining space so actions stay right */
    min-width: 0; /* enable truncation when space is tight */
  }

  .header-title-group h1 {
    @apply text-xl font-bold tracking-tight m-0 leading-tight;
    /* allow wrapping so actions don't get pushed out of the header */
    overflow: visible;
    text-overflow: unset;
    white-space: normal;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    max-height: 3.2rem; /* approx. 2 lines */
  }

  .title-icon {
    @apply inline-block w-7 text-center;
  }

  .title-text-short {
    @apply hidden;
  }

  .status-info {
    @apply text-xs font-normal mt-0.5 pl-7 text-text-secondary-light;
  }

  .status-version {
    @apply text-2xs text-text-secondary-light mt-0.5 pl-7;
    font-size: 11px;
    opacity: 0.85;
  }

  .dark .status-info {
    @apply text-text-secondary-dark;
  }

  .header-actions {
    @apply flex items-center gap-3;
    flex-shrink: 0; /* prevent actions from shrinking/wrapping under title */
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
  }

  /* Buttons */
  .nav-btn {
    @apply flex items-center justify-center px-4 py-2 rounded-lg text-sm font-semibold;
    @apply transition-all duration-200 cursor-pointer;
    @apply bg-bg-primary-light border border-border-light text-text-primary-light;
    @apply shadow-custom-light;
    height: 44px;
    width: 140px;
  }

  .dark .nav-btn {
    @apply bg-bg-primary-dark border-border-dark text-text-primary-dark shadow-custom-dark;
  }

  .nav-btn:hover,
  .nav-btn.active {
    @apply -translate-y-px border-accent;
    @apply bg-bg-card-light shadow-hover-light;
  }

  .dark .nav-btn:hover,
  .dark .nav-btn.active {
    @apply bg-bg-card-dark shadow-hover-dark;
  }

  .btn-icon {
    @apply mr-2 text-lg;
  }

  .btn-text {
    /* Shown by default, hidden on mobile via media query */
  }

  /* Theme toggle */
  .theme-toggle {
    @apply flex items-center justify-center rounded-lg cursor-pointer;
    @apply transition-all duration-200 border;
    @apply bg-bg-primary-light border-border-light text-text-primary-light shadow-custom-light;
    width: 44px;
    height: 44px;
  }

  .dark .theme-toggle {
    @apply bg-bg-primary-dark border-border-dark text-text-primary-dark shadow-custom-dark;
  }

  .theme-toggle:hover {
    @apply scale-110 bg-bg-card-light;
  }

  .dark .theme-toggle:hover {
    @apply bg-bg-card-dark;
  }

  /* Donate / BuyCoffee button */
  .donate-btn {
    @apply flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold;
    @apply transition-all duration-200 cursor-pointer;
    @apply bg-yellow-50 border border-yellow-200 text-yellow-800;
    height: 44px;
    width: auto;
  }

  .dark .donate-btn {
    @apply bg-yellow-900 border-yellow-700 text-yellow-300;
  }

  .donate-badge {
    @apply inline-flex items-center justify-center rounded-md text-lg;
    width: 28px;
    height: 28px;
    background: rgba(250, 204, 21, 0.12);
  }

  .donate-btn:hover {
    @apply -translate-y-px shadow-hover-light;
  }

  .tooltip-wrapper {
    position: relative;
    display: inline-block;
  }

  /* clearer, higher-contrast tooltip that appears below the button */
  .tooltip-text {
    position: absolute;
    top: 0;
    left: 0;
    transform: translateY(-6px);
    opacity: 0;
    pointer-events: none;
    width: max-content;
    max-width: min(260px, calc(100vw - 16px));
    text-align: center;
    @apply bg-bg-card-light text-sm text-text-primary-light border border-border-light rounded-md px-3 py-2 shadow-lg transition-all duration-150;
    white-space: normal; /* allow wrapping and explicit line breaks */
    line-height: 1.3;
    word-break: break-word;
    z-index: 9999;
  }

  .tooltip-text::after {
    content: '';
    position: absolute;
    top: -6px;
    left: var(--tooltip-arrow-left, 16px);
    border-width: 6px;
    border-style: solid;
    border-color: transparent transparent var(--tw-bg-opacity, currentColor) transparent;
  }

  .tooltip-text[data-placement='top'] {
    transform: translateY(6px);
  }

  .tooltip-text[data-placement='top']::after {
    top: auto;
    bottom: -6px;
    border-color: var(--tw-bg-opacity, currentColor) transparent transparent transparent;
  }

  .tooltip-sub {
    @apply text-xs text-text-secondary-light mt-1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }

  .tooltip-line {
    display: block;
    white-space: nowrap;
  }

  .tooltip-link {
    white-space: nowrap;
    text-decoration: underline;
    cursor: pointer;
    color: inherit;
  }

  .dark .tooltip-text {
    @apply bg-bg-card-dark text-text-primary-dark border-border-dark;
  }

  .tooltip-wrapper:hover .tooltip-text,
  .tooltip-wrapper:focus-within .tooltip-text {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  /* Palette selector */
  .palette-group {
    @apply flex items-center gap-2 mr-2 pr-3 border-r border-border-light;
  }

  .dark .palette-group {
    @apply border-border-dark;
  }

  .palette-label {
    @apply text-xs font-semibold mr-1 text-text-secondary-light;
  }

  .dark .palette-label {
    @apply text-text-secondary-dark;
  }

  .palette-btn {
    @apply w-5 h-5 rounded-full border-2 border-transparent cursor-pointer transition-transform duration-200;
  }

  .palette-btn:hover {
    @apply scale-125;
  }

  .palette-btn.active {
    @apply border-current;
    box-shadow: 0 0 5px var(--accent-glow);
  }

  .palette-toggle-btn {
    @apply px-2.5 py-1 text-xs rounded border cursor-pointer transition-all duration-200;
    @apply bg-bg-primary-light border-border-light text-text-secondary-light;
  }

  .dark .palette-toggle-btn {
    @apply bg-bg-primary-dark border-border-dark text-text-secondary-dark;
  }

  .palette-toggle-btn:hover {
    @apply bg-bg-card-light text-text-primary-light;
  }

  .dark .palette-toggle-btn:hover {
    @apply bg-bg-card-dark text-text-primary-dark;
  }

  /* Dashboard */
  .subtitle {
    @apply mb-6 text-base text-text-secondary-light;
    @apply w-full text-center;
  }

  .dark .subtitle {
    @apply text-text-secondary-dark;
  }

  .grid-container {
    @apply grid gap-6 mb-8 w-full;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }

  .parking-card {
    @apply rounded-card p-4 flex flex-col items-center justify-center;
    @apply transition-transform duration-200 border;
    @apply bg-bg-secondary-light border-border-light shadow-custom-light;
  }

  .dark .parking-card {
    @apply bg-bg-secondary-dark border-border-dark shadow-custom-dark;
  }

  .parking-card:hover {
    @apply scale-105;
  }

  .parking-name {
    @apply text-base font-semibold mb-1 text-center text-text-secondary-light;
  }

  .dark .parking-name {
    @apply text-text-secondary-dark;
  }

  .free-spots {
    @apply text-spot-number font-bold text-success-dark;
    @apply flex items-center justify-center gap-1;
  }

  body:not(.dark) .free-spots {
    @apply text-success-light;
  }

  .free-spots.age-old {
    @apply text-warning-dark;
  }

  body:not(.dark) .free-spots.age-old {
    @apply text-warning-light;
  }

  .free-spots.age-medium {
    @apply text-warning-medium-dark;
  }

  body:not(.dark) .free-spots.age-medium {
    @apply text-warning-medium-light;
  }

  .status-icon-number {
    @apply inline-block text-2xl;
  }

  .age-indicator-small {
    @apply text-xs mt-1 text-text-secondary-light;
  }

  .dark .age-indicator-small {
    @apply text-text-secondary-dark;
  }

  /* Approximation indicators */
  .approx-indicator {
    @apply ml-1 text-warning-medium-light font-normal;
    font-size: inherit;
    line-height: 1;
    vertical-align: baseline;
  }

  .dark .approx-indicator {
    @apply text-warning-medium-dark;
  }

  .approx-indicator-small {
    @apply ml-1 text-warning-medium-light font-normal;
    font-size: inherit;
    line-height: 1;
    vertical-align: baseline;
  }

  .dark .approx-indicator-small {
    @apply text-warning-medium-dark;
  }

  .original-value,
  .original-total {
    @apply text-xs mt-1 text-text-secondary-light italic;
  }

  .dark .original-value,
  .dark .original-total {
    @apply text-text-secondary-dark;
  }

  /* Status panel */
  .status-panel {
    @apply flex flex-col rounded-card mb-4 border w-full;
    @apply bg-bg-secondary-light border-border-light shadow-custom-light;
  }

  .dark .status-panel {
    @apply bg-bg-secondary-dark border-border-dark shadow-custom-dark;
  }

  .panel-sections-wrapper {
    @apply flex justify-between w-full;
  }

  .panel-section {
    @apply flex-1 p-6 flex flex-col items-center text-center;
  }

  .status-label {
    @apply text-sm mb-2 text-text-secondary-light;
  }

  .dark .status-label {
    @apply text-text-secondary-dark;
  }

  .status-value {
    @apply text-3xl font-bold text-success-dark;
  }

  body:not(.dark) .status-value {
    @apply text-success-light;
  }

  .status-value.age-old {
    @apply text-warning-dark;
  }

  body:not(.dark) .status-value.age-old {
    @apply text-warning-light;
  }

  .status-value.age-medium {
    @apply text-warning-medium-dark;
  }

  body:not(.dark) .status-value.age-medium {
    @apply text-warning-medium-light;
  }

  .status-description {
    @apply mt-4 mb-8 px-6 text-center font-bold w-full;
    @apply text-success-dark;
    font-size: 1.125rem; /* 18px for wide screen */
  }

  body:not(.dark) .status-description {
    @apply text-success-light;
  }

  .dark .status-description {
    @apply text-success-dark;
  }

  .status-description.age-old {
    @apply text-warning-dark;
  }

  body:not(.dark) .status-description.age-old {
    @apply text-warning-light;
  }

  .status-description.age-medium {
    @apply text-warning-medium-dark;
  }

  body:not(.dark) .status-description.age-medium {
    @apply text-warning-medium-light;
  }

  .big-value {
    @apply text-[2.5rem];
  }

  .time-group {
    @apply flex items-baseline gap-3 font-bold;
  }

  .status-current-inline {
    @apply text-base text-text-secondary-light;
  }

  .dark .status-current-inline {
    @apply text-text-secondary-dark;
  }

  /* Error state */
  .error {
    @apply rounded-lg p-4 mb-4 text-warning-dark;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid currentColor;
  }

  body:not(.dark) .error {
    @apply text-warning-light;
  }

  /* Statistics */
  .stats-container {
    @apply flex-1 relative p-0 w-full overflow-hidden;
  }

  /* Loader */
  .loader {
    @apply flex justify-center items-center h-full text-xl text-accent;
  }
}

/* Responsive styles */
@media (max-width: 600px) {
  html {
    height: -webkit-fill-available;
  }

  .page-wrapper {
    min-height: -webkit-fill-available;
  }

  .container-main {
    @apply px-4 py-3;
  }

  .stats-container {
    @apply pb-[55px] min-h-0;
  }

  .header-controls {
    @apply px-2;
    height: 54px;
    padding-right: 110px; /* smaller reserve on narrow screens */
  }

  .container-main {
    /* smaller top padding on narrow screens to match reduced header height */
    padding-top: 70px;
  }

  .header-title-group h1 {
    @apply text-[1.3rem];
  }

  .title-text-full {
    @apply hidden;
  }

  .title-text-short {
    @apply inline;
  }

  /* keep most buttons icon-only on small screens, but allow donate button text to show when space permits */
  .btn-text {
    @apply hidden;
  }

  /* On very small screens show donate text and prevent the donate button from collapsing */
  .donate-btn {
    width: auto;
    min-width: 88px;
    padding-left: 8px;
    padding-right: 8px;
  }

  .donate-btn .btn-text {
    display: inline-block;
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .donate-btn.show-text .btn-text {
    max-width: 160px;
  }

  .btn-icon {
    @apply mr-0;
  }

  .nav-btn {
    @apply px-0;
    width: 44px;
    height: 38px;
  }

  .theme-toggle {
    @apply text-base;
    width: 44px;
    height: 38px;
  }

  .status-info {
    @apply hidden;
  }

  .status-panel {
    @apply flex-col;
  }

  .panel-sections-wrapper {
    @apply flex-col;
  }

  .panel-section {
    @apply border-b p-3 border-border-light;
  }

  .dark .panel-section {
    @apply border-border-dark;
  }

  .panel-section:last-child {
    @apply border-b-0;
  }

  .subtitle {
    @apply mb-4;
  }

  .status-panel {
    @apply mb-3;
  }

  .status-description {
    font-size: 0.75rem; /* 12px for mobile - compact */
    @apply px-4 mt-3 mb-4;
  }

  .grid-container {
    @apply grid-cols-2 gap-3 mb-4;
  }

  .free-spots {
    font-size: 3.5rem; /* Reduced from 5.2rem to match desktop */
  }

  .parking-card {
    @apply p-3;
  }

  .palette-group {
    @apply border-r-0 pr-0;
  }

  .palette-label,
  .palette-toggle-btn {
    @apply hidden;
  }

  .palette-btn {
    @apply w-[18px] h-[18px];
  }
}